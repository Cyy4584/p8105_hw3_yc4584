p8105_hw3_yc4584
================
Yingyu Cui
2024-10-08

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.1     ✔ tibble    3.2.1
    ## ✔ lubridate 1.9.3     ✔ tidyr     1.3.1
    ## ✔ purrr     1.0.2     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(patchwork)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1

``` r
library(p8105.datasets)
data("ny_noaa")
```

``` r
na_counts = colSums(is.na(ny_noaa))

print(na_counts)
```

    ##      id    date    prcp    snow    snwd    tmax    tmin 
    ##       0       0  145838  381221  591786 1134358 1134420

- A short discription: There are 2595176 rows and 7 columns in this data
  frame. The data frame contains the information of the weather in New
  York from January 1, 1981 through December 31, 2010. The key variables
  are “date”, “temperature_min”, “temperature_max”, “precipitation”,
  “snowfall”, “snow_depth”. In all of the variables, the “prcp”, “snow”
  and “snwd” variables are numeric variables and the “tmax”, “tmin” and
  “id” are recognized as character variables. However, I would prefer to
  transfer “tman” and “tmin” into numeric characters. The missing data
  in every column is shown in the following table. id date prcp snow
  snwd tmax tmin 0 0 145838 381221 591786 1134358 1134420 We can see
  that there are around half of the data missing in the “tmax” and
  “tmin” columns. In “prcp”, “snow” and “snwd” columns, there are less
  data missing, but still a large amount of data missing.

Question 1: - Create separate variables for year, month, and day

``` r
ny_noaa = ny_noaa |> 
  mutate(year = year(date),
         month = month(date),
         day = day(date))
```

- Ensure observations for temperature, precipitation, and snowfall are
  given in reasonable units we want the units for “prcp”, “snow” and
  “snwd” to be tenths of mm, and the units for “tmax” and “tmin” to be
  in Celsius.

``` r
ny_noaa = ny_noaa |>
  mutate(tmax = as.numeric(tmax)) |>
  mutate(tmin = as.numeric(tmin)) |>
  mutate(
    prcp = ifelse(is.na(prcp), NA, prcp * 1/10),
    snow = ifelse(is.na(snow), NA, snow * 1/10),
    snwd = ifelse(is.na(snwd), NA, snwd * 1/10),
    tmax = ifelse(is.na(tmax), NA, (tmax - 32) * 5/9),
    tmin = ifelse(is.na(tmin), NA, (tmin - 32) * 5/9)
  )
```

- most commonly observed values for snowfall

``` r
common_snowfall = ny_noaa |> 
  count(snow) |> 
  arrange(desc(n))

print(common_snowfall)
```

    ## # A tibble: 282 × 2
    ##     snow       n
    ##    <dbl>   <int>
    ##  1   0   2008508
    ##  2  NA    381221
    ##  3   2.5   31022
    ##  4   1.3   23095
    ##  5   5.1   18274
    ##  6   7.6   10173
    ##  7   0.8    9962
    ##  8   0.5    9748
    ##  9   3.8    9197
    ## 10   0.3    8790
    ## # ℹ 272 more rows

We could find out that the most commonly observed value for snowfall is
0.0, which is 381221 times. I think this is because that snowfall is not
a daily occurrence in most regions. Many places experience long periods
without any snowfall, especially during non-winter months. Even in
regions where snow is common, there are often days when no snow falls.

Question2: - Make a two-panel plot showing the average max temperature
in January and in July in each station across years.

``` r
ny_noaa_filtered_plot = ny_noaa |> 
  filter(month %in% c(1, 7)) |> 
  group_by(id, year, month) |> 
  summarize(avg_tmax = mean(tmax, na.rm = TRUE)) |> 
  ggplot(aes(x = year, y = avg_tmax)) +
  geom_point() +
  facet_grid(. ~ month) +
  labs(
    title = "Average Maximum Temperature in January and July",
    x = "Year",
    y = "Average Max Temperature (°C)"
  ) 
```

    ## `summarise()` has grouped output by 'id', 'year'. You can override using the
    ## `.groups` argument.

``` r
print(ny_noaa_filtered_plot)
```

    ## Warning: Removed 5970 rows containing missing values or values outside the scale range
    ## (`geom_point()`).

<img src="p8105_hw3_yc4584_files/figure-gfm/two-panel plot showing the average max temperature-1.png" width="90%" />

- A short discription:Is there any observable / interpretable structure?
  Any outliers? From the plot, we could see that the average maximum
  temperature in January is lower than that in July. The average maximum
  temperature in July is more stable than that In January. There are
  some outliers in the plot, but they are not very significant. The
  outliers in the January plot are approximately equally distributed in
  the lower and higher parts of the plot. The outliers in the July plot
  are mainly distributed in the lower part of the plot.

Question3: - Part (i): tmax vs tmin plot using hexbin plot

``` r
p1 = ggplot(ny_noaa, aes(x = tmin, y = tmax)) +
  geom_hex() +
  labs(
    title = "tmax vs tmin",
    x = "Minimum Temperature (°C)",
    y = "Maximum Temperature (°C)",
    fill = "Count"
  ) 
print(p1)
```

    ## Warning: Removed 1136276 rows containing non-finite outside the scale range
    ## (`stat_binhex()`).

<img src="p8105_hw3_yc4584_files/figure-gfm/tmax vs tmin plot-1.png" width="90%" />
Part (ii): Distribution of snowfall values \> 0 and \< 100, separated by
year

``` r
p2 = ny_noaa |> 
  filter(snow > 0 & snow < 100) |> 
  ggplot(aes(x = snow)) +
  geom_histogram(fill = "skyblue", color = "black") +
  facet_grid(. ~ year) +
  labs(
    title = "Distribution of Snowfall (0 < snowfall < 100)",
    x = "Snowfall (tenths of mm)",
    y = "Count"
  )
print(p2)
```

    ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.

<img src="p8105_hw3_yc4584_files/figure-gfm/Distribution of snowfall values-1.png" width="90%" />

Combination of p1 and p2

``` r
library(gridExtra)
```

    ## 
    ## 载入程序包：'gridExtra'

    ## The following object is masked from 'package:dplyr':
    ## 
    ##     combine

``` r
grid.arrange(p1, p2, nrow = 1) 
```

    ## Warning: Removed 1136276 rows containing non-finite outside the scale range
    ## (`stat_binhex()`).

    ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.

<img src="p8105_hw3_yc4584_files/figure-gfm/Combination of p1 and p2-1.png" width="90%" />

# Problem 2

Load data

``` r
demographic_df = read_csv("./data/nhanes_covar.csv", skip = 4)
```

    ## Rows: 250 Columns: 5
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (5): SEQN, sex, age, BMI, education
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
accelerometer_df = read_csv("./data/nhanes_accel.csv")
```

    ## Rows: 250 Columns: 1441
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (1441): SEQN, min1, min2, min3, min4, min5, min6, min7, min8, min9, min1...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

tidy the data

``` r
demographic_df = demographic_df |> 
  janitor::clean_names() |>
  drop_na() |> 
  filter(age >= 21) |> 
  mutate(sex = as.character(sex)) |> 
  mutate(
    sex = case_when(
      sex == "1" ~ "male",
      sex == "2" ~ "female")) |>
  mutate(education = as.character(education)) |> 
  mutate(
    education = case_when(
      education == "1" ~ "less than high school",
      education == "2" ~ "high school equivalent",
      education == "3" ~ "more than high school")) |> 
  mutate(
    education = factor(
      education, 
      levels = c("less than high school", "high school equivalent", "more than high school")))
```

``` r
accelerometer_df = accelerometer_df |> 
  janitor::clean_names()
```

merge the data sets

``` r
merge_df = left_join(demographic_df, accelerometer_df, by = "seqn")
```

men and women in each education category

``` r
gender_education_df = merge_df |> 
  group_by(sex, education) |>
  summarize(count = n()) |> 
  pivot_wider(names_from = education, values_from = count)
```

    ## `summarise()` has grouped output by 'sex'. You can override using the `.groups`
    ## argument.

``` r
print(gender_education_df)
```

    ## # A tibble: 2 × 4
    ## # Groups:   sex [2]
    ##   sex    `less than high school` `high school equivalent` more than high schoo…¹
    ##   <chr>                    <int>                    <int>                  <int>
    ## 1 female                      28                       23                     59
    ## 2 male                        27                       35                     56
    ## # ℹ abbreviated name: ¹​`more than high school`

age distribution for men and women in different education

``` r
hist_distribution = merge_df |>
  ggplot(aes(x = age, fill = sex)) +
  geom_histogram(alpha = 0.5, position = "identity") +
  facet_wrap(~ education) +
  labs(
    title = "Age Distribution by Gender in Each Education Category",
    x = "Age",
    y = "Count",
    fill = "Gender"
  ) 
print(hist_distribution)
```

    ## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.

<img src="p8105_hw3_yc4584_files/figure-gfm/age distribution-1.png" width="90%" />
We could see from this histogram and the table that in this study the
people from the “more than high school” education category are the most,
and the number of people from the “less than high school” and “high
school equivalent” education category are similar. In the “high school
equivalent” education level, the number of women are more than men, but
in the other two education levels, the number of men and women are
similar. The age distribution in the “more than high school” education
category is more concentrated in the younger age, and the age
distribution in the “less than high school” education category is more
concentrated in the older age. The age distribution in the “high school
equivalent” education category is concentrated in the extreme young and
extreme old age, the distribution in the middle age is pretty much even.

plot total activity against age

``` r
start_col = which(names(merge_df) == "min1")
end_col = which(names(merge_df) == "min1440")
numeric_cols_to_sum = names(merge_df)[start_col:end_col]
merge_df$total_activity = rowSums(merge_df[numeric_cols_to_sum])
print(merge_df)
```

    ## # A tibble: 228 × 1,446
    ##     seqn sex      age   bmi education     min1   min2   min3  min4   min5   min6
    ##    <dbl> <chr>  <dbl> <dbl> <fct>        <dbl>  <dbl>  <dbl> <dbl>  <dbl>  <dbl>
    ##  1 62161 male      22  23.3 high school… 1.11  3.12   1.47   0.938 1.60   0.145 
    ##  2 62164 female    44  23.2 more than h… 1.92  1.67   2.38   0.935 2.59   5.22  
    ##  3 62169 male      21  20.1 high school… 5.85  5.18   4.76   6.48  6.85   7.24  
    ##  4 62174 male      80  33.9 more than h… 5.42  3.48   3.72   3.81  6.85   4.45  
    ##  5 62177 male      51  20.1 high school… 6.14  8.06   9.99   6.60  4.57   2.78  
    ##  6 62178 male      80  28.5 high school… 0.167 0.429  0.131  1.20  0.0796 0.0487
    ##  7 62180 male      35  27.9 more than h… 0.039 0      0      0     0.369  0.265 
    ##  8 62184 male      26  22.1 high school… 1.55  2.81   3.86   4.76  6.10   7.61  
    ##  9 62189 female    30  22.4 more than h… 2.81  0.195  0.163  0     0.144  0.180 
    ## 10 62199 male      57  28   more than h… 0.031 0.0359 0.0387 0.079 0.109  0.262 
    ## # ℹ 218 more rows
    ## # ℹ 1,435 more variables: min7 <dbl>, min8 <dbl>, min9 <dbl>, min10 <dbl>,
    ## #   min11 <dbl>, min12 <dbl>, min13 <dbl>, min14 <dbl>, min15 <dbl>,
    ## #   min16 <dbl>, min17 <dbl>, min18 <dbl>, min19 <dbl>, min20 <dbl>,
    ## #   min21 <dbl>, min22 <dbl>, min23 <dbl>, min24 <dbl>, min25 <dbl>,
    ## #   min26 <dbl>, min27 <dbl>, min28 <dbl>, min29 <dbl>, min30 <dbl>,
    ## #   min31 <dbl>, min32 <dbl>, min33 <dbl>, min34 <dbl>, min35 <dbl>, …

``` r
scatterplot_total_activity = merge_df |>
  ggplot(aes(x = age, y = total_activity, color = sex)) +
  geom_point(alpha = 0.6) +
  geom_smooth(method = "loess", se = FALSE) + 
  facet_wrap(~ education) +  
  labs(title = "Total Activities by Age, Gender, and Education Level",
       x = "Age",
       y = "Total Activity",
       color = "Gender") 
print(scatterplot_total_activity)
```

    ## `geom_smooth()` using formula = 'y ~ x'

<img src="p8105_hw3_yc4584_files/figure-gfm/plot scatterplot-1.png" width="90%" />
comment: From the plot, we could see that the general trends of total
activity in all types of population are decreasing with age. However,
with age growing, the total activity of people with “less than high
school” education level is decreasing faster than the other two
education levels. The total activity of people with “more than high
school” education level is decreasing slower than the other two
education levels. Specifically, there is a peak of total activity in the
population with “less than high school” education level at the age of
around 60. For the people with “high school equivalent” education level,
the increase or peak is at the age of around 40. For the people with
“more than high school” education level, the trend is more stable and
the peak for women is at the age of around 50, for man is at the age of
around 60. For sex, in both “high school equivalent” and “more than high
school”, the total activity in women is lower than men at the same age.
However, in the “less than high school” education level, the women older
than 40 have higher total activity than men at the same age.

24 hours activity time course

``` r
time_course = merge_df |>
  select(seqn, sex, education, starts_with("min")) |>
  pivot_longer(cols = starts_with("min"), names_to = "minute", values_to = "activity") |>
  mutate(minute = as.numeric(str_remove(minute, "min"))) 
```

``` r
time_course_plot = 
  ggplot(time_course, aes(x = minute, y = activity, color = sex)) +
  geom_line(alpha = 0.6) +
  geom_smooth(method = "loess", se = FALSE, linetype = "dashed") +
  facet_wrap(~ education) +
  labs(title = "24-Hour Activity Time Courses by Education Level",
       x = "Minute of the Day",
       y = "Activity Time",
       color = "Gender")
print(time_course_plot)
```

    ## `geom_smooth()` using formula = 'y ~ x'

<img src="p8105_hw3_yc4584_files/figure-gfm/plot 24 hours activity time course-1.png" width="90%" />

comment: We could see from the plot that the highest activity time in a
day for different educational level is different, but the lowest
activity time for them all are around 4:00-5:00. For the people with
“less than high school” education level, the highest activity time is
around 10:00-11:00, and the activity time is decreasing after that. For
the people with “high school equivalent” education level, the highest
activity time is around 8:00-9:00, and the activity time is decreasing
after that with a small peak at around 19:00-20:00 for women in this
educational type. For the people with “more than high school” education
level, the highest activity time is around 8:00-9:00 for men and
20:00-21:00 for women, and the activity time is relatively low between
these. In general, the activity time of people with “more than high
school” education level is higher than the other two education levels.
Although there are difference in the activity time between gender and
educational level, the general trend in three panels are similar. The
activity time is increasing to peak of the day at 12:00-13:00 and
decreasing. Also, the difference between gender is not very significant.
Maybe, the women with “less than high school” education level has
slightly more activity time than men in this educational level, but the
difference is not very significant. In the other two panels, activity
time for men is slightly higher than women.
